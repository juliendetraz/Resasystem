<% title @housing.name %>
<h1 id="page_title"><%= @housing.name %></h1>

<div id="content_member_left">

  <div id="housing_show_addr">
    <%= "<span>#{t('member.housing.city')+t('2p')}</span> #{@housing.address.city}<br />".html_safe if @housing.address.city %>
    <%= "<span>#{t('member.housing.country')+t('2p')}</span> #{@housing.address.country}<br />".html_safe if @housing.address.country %>
    <%= "<span>#{t('member.housing.state_province_country')+t('2p')}</span> #{@housing.address.state_province_country}<br />".html_safe if @housing.address.state_province_country %>
    <%= "<span>#{t('member.housing.website')+t('2p')}</span> #{link_to @housing.website, @housing.website, :target => '_blank'}<br />".html_safe if @housing.email %>
  </div>

  <%= render :partial => 'slideshow' %>


  <h2><%= t('member.housing.description') %></h2>
  <h3><%= t('member.housing.the_housing')+t('2p') %></h3>
  <p><%= @housing.description %></p>

  <%= render :partial => 'list_services', :locals => { :service_type => 'asset' } %>
  <%= render :partial => 'list_services', :locals => { :service_type => 'activity' } %>
  <%= render :partial => 'list_services', :locals => { :service_type => 'comfort' } %>


  <h2>Tarifs</h2>

  <%= link_to 'Nouvelle annonce pour cet housing', get_module_path("new_%_housing_ad", @housing) %> |
  <%= link_to 'Edit', get_module_path("edit_%_housing", @housing) %>

</div>

<div id="content_member_right">

  <div id="button-add_to_favorites"><%= t('add_to_favorites') %></div>
  <div id="button-print_it"><%= t('print_it') %></div>

  <div id="map_block-container">
    <div id="map_block-header"><%= t('map') %></div>
    <div id="gmap" style="width: 298px; height: 282px">
    </div>
  </div>
  
  <div id="housing_show_pois">
    <h3><%= t('member.housing.near')+t('2p') %></h3>
    <%= "<span>#{t('member.housing.commerce')+t('2p')}</span>#{t("member.housing.housing_distances.#{@housing.distance_commerce}")}<br />".html_safe if @housing.distance_commerce %>
    <%= "<span>#{t('member.housing.transport')+t('2p')}</span>#{t("member.housing.housing_distances.#{@housing.distance_transport}")}<br />".html_safe if @housing.distance_transport %>
    <%= "<span>#{t('member.housing.train')+t('2p')}</span>#{t("member.housing.housing_distances.#{@housing.distance_train}")}".html_safe if @housing.distance_train %>
    <% if @housing.housing_pois.count > 0 %>
      <ul class="puce-green-plus">
        <% @housing.housing_pois.each do |housing_poi| %>
        <li><%= "<strong>#{housing_poi.name}</strong>#{t('2p')}#{housing_poi.distance.to_s}".html_safe %>km</li>
        <% end  %>
      </ul>
    <% end  %>
  </div>
</div>


<% content_for :additional_css do %>
  <%= stylesheet_link_tag 'galleriffic' %>
<% end %>


<% content_for :additional_js_bottom do %>
  <%= javascript_include_tag 'http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js' %>
  <% javascript_tag do %>
     jQuery.noConflict();
  <% end %>
  <%= javascript_include_tag 'jquery.galleriffic', 'jquery.history', 'jquery.opacityrollover' %>

  <script type="text/javascript">
      jQuery(document).ready(function($) {
          // We only want these styles applied when javascript is enabled
          $('div.navigation').css({'width' : '235px', 'float' : 'right'});
          $('div.content').css('display', 'block');

          // Initially set opacity on thumbs and add
          // additional styling for hover effect on thumbs
          var onMouseOutOpacity = 0.67;
          $('#thumbs ul.thumbs li').opacityrollover({
              mouseOutOpacity:   onMouseOutOpacity,
              mouseOverOpacity:  1.0,
              fadeSpeed:         'fast',
              exemptionSelector: '.selected'
          });

          // Initialize Advanced Galleriffic Gallery
          var gallery = $('#thumbs').galleriffic({
              delay:                     2500,
              numThumbs:                 6,
              preloadAhead:              3,
              enableTopPager:            true,
              enableBottomPager:         false,
              maxPagesToShow:            5,
              imageContainerSel:         '#slideshow',
              controlsContainerSel:      '#controls',
              captionContainerSel:       '#caption',
              loadingContainerSel:       '#loading',
              renderSSControls:          false,
              renderNavControls:         false,
              playLinkText:              'Play Slideshow',
              pauseLinkText:             'Pause Slideshow',
              prevLinkText:              '&lsaquo; Previous Photo',
              nextLinkText:              'Next Photo &rsaquo;',
              nextPageLinkText:          'Next &rsaquo;',
              prevPageLinkText:          '&lsaquo; Prev',
              enableHistory:             true,
              autoStart:                 false,
              syncTransitions:           true,
              defaultTransitionDuration: 900,
              onSlideChange:             function(prevIndex, nextIndex) {
                  // 'this' refers to the gallery, which is an extension of $('#thumbs')
                  this.find('ul.thumbs').children()
                      .eq(prevIndex).fadeTo('fast', onMouseOutOpacity).end()
                      .eq(nextIndex).fadeTo('fast', 1.0);
              },
              onPageTransitionOut:       function(callback) {
                  this.fadeTo('fast', 0.0, callback);
              },
              onPageTransitionIn:        function() {
                  this.fadeTo('fast', 1.0);
              }
          });

          /**** Functions to support integration of galleriffic with the jquery.history plugin ****/

          // PageLoad function
          // This function is called when:
          // 1. after calling $.historyInit();
          // 2. after calling $.historyLoad();
          // 3. after pushing "Go Back" button of a browser
          function pageload(hash) {
              // alert("pageload: " + hash);
              // hash doesn't contain the first # character.
              if(hash) {
                  $.galleriffic.gotoImage(hash);
              } else {
                  gallery.gotoIndex(0);
              }
          }

          // Initialize history plugin.
          // The callback is called at once by present location.hash.
          $.historyInit(pageload, "advanced.html");

          // set onlick event for buttons using the jQuery 1.3 live method
          $("a[rel='history']").live('click', function(e) {
              if (e.button != 0) return true;

              var hash = this.href;
              hash = hash.replace(/^.*#/, '');

              // moves to a new page.
              // pageload is called at once.
              // hash don't contain "#", "?"
              $.historyLoad(hash);

              return false;
          });

          /****************************************************************************************/
      });
  </script>
<% end %>